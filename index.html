<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title></title>
	<script src="lib/path-finder/ProblemSolvingAgent.js"></script>
	<script src="lib/path-finder/Space.js"></script>
	<style>
		#svg-space {
			/*background-image: url('img/maze.svg');*/
			background-position: 13px;
			background-repeat: no-repeat;
		}

		#img1 > image,
		#pacman-pattern > image {
			-webkit-transition: transform .3s;
			-moz-transition: transform .3s;
			-ms-transition: transform .3s;
			-o-transition: transform .3s;
			transition: transform .3s;
		}
		#img1 > image.right,
		#pacman-pattern > image.right {
			transform: translate(3px, 0);
			animation: eat-right .2s steps(4) infinite;
		}

		@keyframes eat-right {
			100% { transform: translate(-44px, 0); }
		}

		#img1 > image.left,
		#pacman-pattern > image.left {
			 transform: rotate(180deg) translate(0px, 0);
			 transform-origin: center;
			 animation: eat-left .2s steps(4) infinite;
		 }

		@keyframes eat-left {
			100% { transform: rotate(180deg) translate(46px, 0); }
		}


		#img1 > image.down,
		#pacman-pattern > image.down {
			transform: rotate(90deg) translate(4px, 1px);
			transform-origin: 9px;
			animation: eat-down .2s steps(4) infinite;
		}

		@keyframes eat-down {
			100% { transform: rotate(90deg) translate(-43px, 1px); }
		}


		#img1 > image.up,
		#pacman-pattern > image.up {
			transform: rotate(-90deg) translate(4px, -1px);
			transform-origin: 9px;
			animation: eat-up .2s steps(4) infinite;
		}

		@keyframes eat-up {
			100% { transform: rotate(-90deg) translate(-43px, -1px); }
		}

	</style>
</head>
<body onload="startSpace()">
<svg id="svg-space" xmlns="http://www.w3.org/2000/svg"
	 xmlns:xlink="http://www.w3.org/1999/xlink"
	 xmlns:ev="http://www.w3.org/2001/xml-events"
	 version="1.1" baseProfile="full">

	<defs>
		<pattern id="img1" patternUnits="userSpaceOnUse" width="15" height="15">
			<image xlink:href="img/pac-eat-right.svg" class="right" width="47" height="15"/>
		</pattern>
	</defs>

</svg>

<script>

//MAIN ##########################
	var space;
	var pacmanAgent;

	function startSpace() {

		if (Space) {
			var walls = JSON.parse('[{"x":0,"y":10},{"x":0,"y":12},{"x":19,"y":7},{"x":12,"y":7},{"x":13,"y":12},{"x":13,"y":13},{"x":13,"y":16},{"x":13,"y":17},{"x":9,"y":9},{"x":10,"y":9},{"x":6,"y":5},{"x":6,"y":7},{"x":6,"y":6},{"x":6,"y":8},{"x":7,"y":7},{"x":8,"y":9},{"x":8,"y":10},{"x":9,"y":10},{"x":10,"y":10},{"x":11,"y":10},{"x":11,"y":9},{"x":9,"y":6},{"x":9,"y":5},{"x":10,"y":5},{"x":8,"y":5},{"x":11,"y":7},{"x":12,"y":6},{"x":12,"y":5},{"x":15,"y":5},{"x":14,"y":5},{"x":16,"y":5},{"x":15,"y":5},{"x":17,"y":5},{"x":18,"y":7},{"x":17,"y":7},{"x":15,"y":7},{"x":15,"y":8},{"x":15,"y":9},{"x":17,"y":9},{"x":16,"y":9},{"x":13,"y":11},{"x":13,"y":10},{"x":4,"y":11},{"x":3,"y":10},{"x":1,"y":10},{"x":2,"y":10},{"x":4,"y":10},{"x":4,"y":12},{"x":3,"y":12},{"x":2,"y":12},{"x":1,"y":12},{"x":15,"y":11},{"x":15,"y":12},{"x":16,"y":11},{"x":17,"y":11},{"x":18,"y":11},{"x":18,"y":9},{"x":16,"y":14},{"x":15,"y":14},{"x":15,"y":16},{"x":15,"y":15},{"x":13,"y":18},{"x":15,"y":17},{"x":15,"y":18},{"x":8,"y":12},{"x":10,"y":12},{"x":9,"y":12},{"x":9,"y":13},{"x":11,"y":12},{"x":7,"y":12},{"x":6,"y":12},{"x":6,"y":14},{"x":7,"y":14},{"x":3,"y":14},{"x":4,"y":14},{"x":4,"y":15},{"x":6,"y":16},{"x":6,"y":17},{"x":5,"y":17},{"x":4,"y":17},{"x":3,"y":17},{"x":7,"y":17},{"x":10,"y":17},{"x":10,"y":16},{"x":9,"y":14},{"x":11,"y":14},{"x":11,"y":15},{"x":11,"y":16},{"x":11,"y":17},{"x":10,"y":18},{"x":11,"y":18},{"x":7,"y":18},{"x":6,"y":18},{"x":5,"y":18},{"x":4,"y":18},{"x":3,"y":18},{"x":6,"y":2},{"x":7,"y":2},{"x":10,"y":1},{"x":10,"y":2},{"x":10,"y":3},{"x":10,"y":0},{"x":12,"y":2},{"x":12,"y":3},{"x":14,"y":3},{"x":13,"y":3},{"x":14,"y":2},{"x":16,"y":2},{"x":18,"y":2},{"x":17,"y":3},{"x":16,"y":3},{"x":18,"y":3},{"x":2,"y":2},{"x":3,"y":2},{"x":4,"y":2},{"x":1,"y":2},{"x":1,"y":1},{"x":2,"y":1},{"x":3,"y":1},{"x":4,"y":1},{"x":6,"y":1},{"x":7,"y":1},{"x":8,"y":1},{"x":8,"y":2},{"x":6,"y":4},{"x":2,"y":4},{"x":4,"y":4},{"x":3,"y":4},{"x":1,"y":4},{"x":1,"y":6},{"x":2,"y":6},{"x":3,"y":6},{"x":4,"y":6},{"x":4,"y":7},{"x":4,"y":8},{"x":3,"y":8},{"x":2,"y":8},{"x":1,"y":8},{"x":1,"y":7},{"x":12,"y":1},{"x":14,"y":1},{"x":13,"y":1},{"x":16,"y":1},{"x":18,"y":1},{"x":17,"y":1},{"x":2,"y":14},{"x":1,"y":17},{"x":1,"y":18},{"x":1,"y":16},{"x":3,"y":15},{"x":16,"y":15},{"x":17,"y":15},{"x":17,"y":14},{"x":17,"y":16},{"x":17,"y":17},{"x":17,"y":18},{"x":16,"y":18},{"x":19,"y":14},{"x":19,"y":15},{"x":19,"y":16},{"x":19,"y":17},{"x":19,"y":18},{"x":1,"y":14},{"x":6,"y":9},{"x":6,"y":10}]');

			space = new Space('http://www.w3.org/2000/svg', 15, new Point(20, 20), 0, '#000', walls);

			space.draw();

			space.bindClickEvent();
			space.bindKeyEvents();
			space.drawWalls();

			pacmanAgent = new PacmanAgent('pacman', new Point(0,0), '#F4D100');
			pacmanAgent.drawInSpace(space);
//			pacmanAgent.bindDragNDrop(space);
		}


		return space;
	}

	function PacmanAgent(a,b,c) {
		Agent.call(this, a,b,c);
	};

	PacmanAgent.prototype = Object.create(Agent.prototype);

	PacmanAgent.prototype.drawInSpace = function(space) {
		this.element = space.createElement(this.name, this.state, 'url(#img1)');

	};

	PacmanAgent.prototype.drawSymbol = function(space){

		var defs = document.createElementNS(this.svg, 'defs');

		var pattern = document.createElementNS(this.svg, 'pattern');
		pattern.setAttributeNS(null, 'id', 'pacman-patt');
		pattern.setAttributeNS(null, 'patternUnits', 'userSpaceOnUse');
		pattern.setAttributeNS(null, 'height', '20');
		pattern.setAttributeNS(null, 'width', '20');
		defs.appendChild(pattern);

		var image = document.createElementNS(this.svg, 'image');
		image.setAttributeNS(null, 'height', '20');
		image.setAttributeNS(null, 'width', '50');
		image.setAttributeNS(null, 'class', 'left');
		image.setAttribute('xmlns:xlink', 'img/pac-eat-right.svg');

		pattern.appendChild(image);

		document.getElementById('svg-space').appendChild(defs);
	};

	Space.prototype.bindKeyEvents = function() {
		var self = this;
		var keyPressed = null;
		var interval;

		//Register the keydown event handler For pacman's movements
		document.onkeydown = function(e) {
			var evt = e ? e : event;

			var keyActions = {
				37: 'left',
				38: 'up',
				39: 'right',
				40: 'down',
			};

			var keyCode = evt.keyCode;
			var keyAction = keyActions[keyCode];

			if (keyAction && (!keyPressed || keyPressed !== keyCode) && pacmanAgent) {
				evt.preventDefault();

				console.log(keyAction);

				clearInterval(interval);

				interval = window.setInterval(function() {

					pacmanAgent.moveInSpace(self, keyAction);

				}, 100);

				keyPressed = keyCode;

				return false;
			};

			return true;
		};


		window.onkeyup = function(e) {
			var evt = e ? e : event;
			keyPressed = null;
		};
	};

</script>
</body>
</html>